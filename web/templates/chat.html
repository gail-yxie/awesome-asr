{% extends "base.html" %}
{% block title %}ASR & Speech Language Chat Assistant{% endblock %}

{% block content %}
<div class="chat-layout">
    <aside class="chat-sidebar" id="chatSidebar">
        <button class="btn new-chat-btn" id="newChatBtn">+ New Chat</button>
        <div class="session-list" id="sessionList"></div>
    </aside>

    <div class="chat-container">
        <div class="chat-header">
            <button class="sidebar-toggle" id="sidebarToggle" title="Toggle history">&#9776;</button>
            <div>
                <h1>ASR & Speech Language Chat Assistant</h1>
                <p>Ask questions about ASR and speech language model research, generate reports, podcasts, mindmaps, and manage notes.</p>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="chat-message assistant">
                <div class="message-bubble">
                    Hi! I'm your ASR & speech language model research assistant. I can help you:
                    <ul>
                        <li>Search and summarize recent papers</li>
                        <li>View the ASR leaderboard and model catalog</li>
                        <li>Generate daily reports, podcasts, and mindmaps</li>
                        <li>Create deep-dive episodes for specific papers</li>
                        <li>Save and manage your research notes</li>
                    </ul>
                    What would you like to know?
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator" style="display: none;">
            <span></span><span></span><span></span>
        </div>

        <div class="audio-preview" id="audioPreview" style="display: none;">
            <audio id="audioPlayback" controls></audio>
            <button class="btn btn-sm btn-secondary" id="discardAudioBtn" title="Discard recording">&times;</button>
        </div>

        <form class="chat-input-form" id="chatForm">
            <input type="text" id="chatInput" placeholder="Ask about ASR & speech language research..." autocomplete="off" />
            <button type="button" class="mic-btn" id="micBtn" title="Record audio">
                <svg class="mic-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
                <svg class="stop-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor" style="display:none;">
                    <rect x="6" y="6" width="12" height="12" rx="2"/>
                </svg>
            </button>
            <button type="submit" id="sendBtn">Send</button>
        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='chat.js') }}"></script>
{% endblock %}
